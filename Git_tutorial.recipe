from calibre.web.feeds.recipes import BasicNewsRecipe

class Git_tutorial(BasicNewsRecipe):
    title = 'Git_tutorial'
    __author__ = 'lord63'
    description = 'Git教程 by 廖雪峰'
    timefmt = '[%Y-%m-%d]'
    no_stylesheets = True
    url_prefix = 'http://www.liaoxuefeng.com'
    keep_only_tags = [dict(name='h4'),
                      dict(name='div', attrs={'class': 'x-wiki-content x-content'})]


    def parse_index(self):
        index_page = self.url_prefix + '/wiki/0013739516305929606dd18361248578c67b8067c8c017b000'
        soup = self.index_to_soup(index_page)
        wiki_tree = soup.find('div', 'x-wiki-tree')
        articles = [{'title': 'Git教程', 'url': index_page}]
        for tag in wiki_tree.findAll('a'):
            title = self.tag_to_string(tag)
            url = self.url_prefix + tag['href']
            article = {'title': title, 'url': url}
            articles.append(article)
        return [('Git_tutorial', articles)]

    def preprocess_html(self, soup):
        for i, tag in zip(range(7),soup.findAll('h4')):
            if i == 2:
                pass
            else:
                tag.extract()
        return soup

